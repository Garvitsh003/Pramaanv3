{"version":3,"file":"tagLines.js","names":["_iterateJsdoc","_interopRequireDefault","require","obj","__esModule","default","_default","iterateJsdoc","context","jsdoc","utils","alwaysNever","count","dropEndLines","noEndLines","tags","options","some","tg","tagIdx","lastTag","lastEmpty","reportIndex","idx","tokens","tag","name","type","description","end","source","entries","_tags$lastTag$slice","_tags$lastTag$slice2","includes","slice","lines","empty","length","fixer","removeTag","tagSourceOffset","reportJSDoc","line","number","currentTag","tagSourceIdx","splice","push","currentTg","tagCount","defaultAlways","overrideAlways","fixCount","_lines2","_lines","addLines","iterateAllJsdocs","meta","docs","url","fixable","schema","enum","additionalProperties","properties","patternProperties","exports","module"],"sources":["../../src/rules/tagLines.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc';\n\nexport default iterateJsdoc(({\n  context,\n  jsdoc,\n  utils,\n}) => {\n  const [\n    alwaysNever = 'never',\n    {\n      count = 1,\n      dropEndLines = false,\n      noEndLines = false,\n      tags = {},\n    } = {},\n  ] = context.options;\n\n  jsdoc.tags.some((tg, tagIdx) => {\n    let lastTag;\n    let lastEmpty = null;\n\n    let reportIndex = null;\n    for (const [\n      idx,\n      {\n        tokens: {\n          tag,\n          name,\n          type,\n          description,\n          end,\n        },\n      },\n    ] of tg.source.entries()) {\n      // May be text after a line break within a tag description\n      if (description) {\n        reportIndex = null;\n      }\n\n      if (lastTag && [\n        'any', 'always',\n      ].includes(tags[lastTag.slice(1)]?.lines)) {\n        continue;\n      }\n\n      const empty = !tag && !name && !type && !description;\n      if (\n        empty && !end &&\n        (alwaysNever === 'never' ||\n          lastTag && tags[lastTag.slice(1)]?.lines === 'never'\n        )\n      ) {\n        reportIndex = idx;\n\n        continue;\n      }\n\n      if (!end) {\n        lastEmpty = empty ? idx : null;\n      }\n\n      lastTag = tag;\n    }\n\n    if (dropEndLines && lastEmpty !== null && tagIdx === jsdoc.tags.length - 1) {\n      const fixer = () => {\n        utils.removeTag(tagIdx, {\n          tagSourceOffset: lastEmpty,\n        });\n      };\n\n      utils.reportJSDoc(\n        'Expected no trailing lines',\n        {\n          line: tg.source[lastEmpty].number,\n        },\n        fixer,\n      );\n\n      return true;\n    }\n\n    if (reportIndex !== null) {\n      const fixer = () => {\n        utils.removeTag(tagIdx, {\n          tagSourceOffset: reportIndex,\n        });\n      };\n\n      utils.reportJSDoc(\n        'Expected no lines between tags',\n        {\n          line: tg.source[0].number + 1,\n        },\n        fixer,\n      );\n\n      return true;\n    }\n\n    return false;\n  });\n\n  (noEndLines ? jsdoc.tags.slice(0, -1) : jsdoc.tags).some((tg, tagIdx) => {\n    const lines = [];\n\n    let currentTag;\n    let tagSourceIdx = 0;\n    for (const [\n      idx,\n      {\n        number,\n        tokens: {\n          tag,\n          name,\n          type,\n          description,\n          end,\n        },\n      },\n    ] of tg.source.entries()) {\n      if (description) {\n        lines.splice(0, lines.length);\n        tagSourceIdx = idx;\n      }\n\n      if (tag) {\n        currentTag = tag;\n      }\n\n      if (!tag && !name && !type && !description && !end) {\n        lines.push({\n          idx,\n          number,\n        });\n      }\n    }\n\n    const currentTg = currentTag && tags[currentTag.slice(1)];\n    const tagCount = currentTg?.count;\n\n    const defaultAlways = alwaysNever === 'always' && currentTg?.lines !== 'never' &&\n      currentTg?.lines !== 'any' && lines.length < count;\n\n    let overrideAlways;\n    let fixCount = count;\n    if (!defaultAlways) {\n      fixCount = typeof tagCount === 'number' ? tagCount : count;\n      overrideAlways = currentTg?.lines === 'always' &&\n        lines.length < fixCount;\n    }\n\n    if (defaultAlways || overrideAlways) {\n      const fixer = () => {\n        utils.addLines(tagIdx, lines[lines.length - 1]?.idx || tagSourceIdx + 1, fixCount - lines.length);\n      };\n\n      const line = lines[lines.length - 1]?.number || tg.source[tagSourceIdx].number;\n      utils.reportJSDoc(\n        `Expected ${fixCount} line${fixCount === 1 ? '' : 's'} between tags but found ${lines.length}`,\n        {\n          line,\n        },\n        fixer,\n      );\n\n      return true;\n    }\n\n    return false;\n  });\n}, {\n  iterateAllJsdocs: true,\n  meta: {\n    docs: {\n      description: 'Enforces lines (or no lines) between tags.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-tag-lines',\n    },\n    fixable: 'code',\n    schema: [\n      {\n        enum: [\n          'always', 'any', 'never',\n        ],\n        type: 'string',\n      },\n      {\n        additionalProperties: false,\n        properties: {\n          count: {\n            type: 'integer',\n          },\n          dropEndLines: {\n            type: 'boolean',\n          },\n          noEndLines: {\n            type: 'boolean',\n          },\n          tags: {\n            patternProperties: {\n              '.*': {\n                additionalProperties: false,\n                properties: {\n                  count: {\n                    type: 'integer',\n                  },\n                  lines: {\n                    enum: [\n                      'always', 'never', 'any',\n                    ],\n                    type: 'string',\n                  },\n                },\n              },\n            },\n            type: 'object',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":"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"}