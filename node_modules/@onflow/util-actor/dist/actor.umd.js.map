{"version":3,"file":"actor.umd.js","sources":["../src/mailbox/index.js","../../../node_modules/queue-microtask/index.js","../src/index.js"],"sourcesContent":["export const mailbox = () => {\n  const queue = []\n  var next\n\n  return {\n    async deliver(msg) {\n      queue.push(msg)\n      if (next) {\n        next(queue.shift())\n        next = undefined\n      }\n    },\n\n    receive() {\n      return new Promise(function innerReceive(resolve) {\n        const msg = queue.shift()\n        if (msg) return resolve(msg)\n        next = resolve\n      })\n    },\n  }\n}\n","/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */\nlet promise\n\nmodule.exports = typeof queueMicrotask === 'function'\n  ? queueMicrotask.bind(typeof window !== 'undefined' ? window : global)\n  // reuse resolved promise, and allocate it lazily\n  : cb => (promise || (promise = Promise.resolve()))\n    .then(cb)\n    .catch(err => setTimeout(() => { throw err }, 0))\n","import {mailbox as createMailbox} from \"./mailbox\"\nimport queueMicrotask from \"queue-microtask\"\n\nexport const INIT = \"INIT\"\nexport const SUBSCRIBE = \"SUBSCRIBE\"\nexport const UNSUBSCRIBE = \"UNSUBSCRIBE\"\nexport const UPDATED = \"UPDATED\"\nexport const SNAPSHOT = \"SNAPSHOT\"\nexport const EXIT = \"EXIT\"\nexport const TERMINATE = \"TERMINATE\"\n\nconst root =\n  (typeof self === \"object\" && self.self === self && self) ||\n  (typeof global === \"object\" && global.global === global && global) ||\n  (typeof window === \"object\" && window.window === window && window)\n\nroot.FCL_REGISTRY = root.FCL_REGISTRY == null ? {} : root.FCL_REGISTRY\nvar pid = 0b0\n\nconst DEFAULT_TIMEOUT = 5000\nconst DEFAULT_TAG = \"---\"\nexport const send = (addr, tag, data, opts = {}) =>\n  new Promise((reply, reject) => {\n    const expectReply = opts.expectReply || false\n    const timeout = opts.timeout != null ? opts.timeout : DEFAULT_TIMEOUT\n\n    if (expectReply && timeout) {\n      setTimeout(\n        () =>\n          reject(new Error(`Timeout: ${timeout}ms passed without a response.`)),\n        timeout\n      )\n    }\n\n    const payload = {\n      to: addr,\n      from: opts.from,\n      tag,\n      data,\n      timeout,\n      reply,\n      reject,\n    }\n\n    try {\n      root.FCL_REGISTRY[addr] &&\n        root.FCL_REGISTRY[addr].mailbox.deliver(payload)\n      if (!expectReply) reply(true)\n    } catch (error) {\n      console.error(\n        \"FCL.Actor -- Could Not Deliver Message\",\n        payload,\n        root.FCL_REGISTRY[addr],\n        error\n      )\n    }\n  })\n\nexport const kill = addr => {\n  delete root.FCL_REGISTRY[addr]\n}\n\nconst fromHandlers =\n  (handlers = {}) =>\n  async ctx => {\n    if (typeof handlers[INIT] === \"function\") await handlers[INIT](ctx)\n    __loop: while (1) {\n      const letter = await ctx.receive()\n      try {\n        if (letter.tag === EXIT) {\n          if (typeof handlers[TERMINATE] === \"function\") {\n            await handlers[TERMINATE](ctx, letter, letter.data || {})\n          }\n          break __loop\n        }\n        await handlers[letter.tag](ctx, letter, letter.data || {})\n      } catch (error) {\n        console.error(`${ctx.self()} Error`, letter, error)\n      } finally {\n        continue __loop\n      }\n    }\n  }\n\nexport const spawn = (fn, addr = null) => {\n  if (addr == null) addr = ++pid\n  if (root.FCL_REGISTRY[addr] != null) return addr\n\n  root.FCL_REGISTRY[addr] = {\n    addr,\n    mailbox: createMailbox(),\n    subs: new Set(),\n    kvs: {},\n    error: null,\n  }\n\n  const ctx = {\n    self: () => addr,\n    receive: () => root.FCL_REGISTRY[addr].mailbox.receive(),\n    send: (to, tag, data, opts = {}) => {\n      opts.from = addr\n      return send(to, tag, data, opts)\n    },\n    sendSelf: (tag, data, opts) => {\n      if (root.FCL_REGISTRY[addr]) send(addr, tag, data, opts)\n    },\n    broadcast: (tag, data, opts = {}) => {\n      opts.from = addr\n      for (let to of root.FCL_REGISTRY[addr].subs) send(to, tag, data, opts)\n    },\n    subscribe: sub => sub != null && root.FCL_REGISTRY[addr].subs.add(sub),\n    unsubscribe: sub => sub != null && root.FCL_REGISTRY[addr].subs.delete(sub),\n    subscriberCount: () => root.FCL_REGISTRY[addr].subs.size,\n    hasSubs: () => !!root.FCL_REGISTRY[addr].subs.size,\n    put: (key, value) => {\n      if (key != null) root.FCL_REGISTRY[addr].kvs[key] = value\n    },\n    get: (key, fallback) => {\n      const value = root.FCL_REGISTRY[addr].kvs[key]\n      return value == null ? fallback : value\n    },\n    delete: key => {\n      delete root.FCL_REGISTRY[addr].kvs[key]\n    },\n    update: (key, fn) => {\n      if (key != null)\n        root.FCL_REGISTRY[addr].kvs[key] = fn(root.FCL_REGISTRY[addr].kvs[key])\n    },\n    keys: () => {\n      return Object.keys(root.FCL_REGISTRY[addr].kvs)\n    },\n    all: () => {\n      return root.FCL_REGISTRY[addr].kvs\n    },\n    where: pattern => {\n      return Object.keys(root.FCL_REGISTRY[addr].kvs).reduce((acc, key) => {\n        return pattern.test(key)\n          ? {...acc, [key]: root.FCL_REGISTRY[addr].kvs[key]}\n          : acc\n      }, {})\n    },\n    merge: (data = {}) => {\n      Object.keys(data).forEach(\n        key => (root.FCL_REGISTRY[addr].kvs[key] = data[key])\n      )\n    },\n    fatalError: error => {\n      root.FCL_REGISTRY[addr].error = error\n      for (let to of root.FCL_REGISTRY[addr].subs) send(to, UPDATED)\n    },\n  }\n\n  if (typeof fn === \"object\") fn = fromHandlers(fn)\n\n  queueMicrotask(async () => {\n    await fn(ctx)\n    kill(addr)\n  })\n\n  return addr\n}\n\n// Returns an unsubscribe function\n// A SUBSCRIBE handler will need to be created to handle the subscription event\n//\n//  [SUBSCRIBE]: (ctx, letter) => {\n//    ctx.subscribe(letter.from)\n//    ctx.send(letter.from, UPDATED, ctx.all())\n//  }\n//\nexport function subscriber(address, spawnFn, callback) {\n  spawnFn(address)\n  const EXIT = \"@EXIT\"\n  const self = spawn(async ctx => {\n    ctx.send(address, SUBSCRIBE)\n    while (1) {\n      const letter = await ctx.receive()\n      const error = root.FCL_REGISTRY[address].error\n      if (letter.tag === EXIT) {\n        ctx.send(address, UNSUBSCRIBE)\n        return\n      }\n      if (error) {\n        callback(null, error)\n        ctx.send(address, UNSUBSCRIBE)\n        return\n      }\n\n      callback(letter.data, null)\n    }\n  })\n  return () => send(self, EXIT)\n}\n\n// Returns a promise that returns a result\n// A SNAPSHOT handler will need to be created to handle the snapshot event\n//\n//  [SNAPSHOT]: (ctx, letter) => {\n//    letter.reply(ctx.all())\n//  }\n//\nexport function snapshoter(address, spawnFn) {\n  spawnFn(address)\n  return send(address, SNAPSHOT, null, {expectReply: true, timeout: 0})\n}\n"],"names":["mailbox","queue","next","deliver","msg","push","shift","undefined","receive","Promise","innerReceive","resolve","promise","queueMicrotask_1","queueMicrotask","bind","window","global","cb","then","catch","err","setTimeout","INIT","SUBSCRIBE","UNSUBSCRIBE","UPDATED","SNAPSHOT","EXIT","TERMINATE","root","self","FCL_REGISTRY","pid","DEFAULT_TIMEOUT","send","addr","tag","data","opts","arguments","length","reply","reject","expectReply","timeout","Error","payload","to","from","error","console","kill","fromHandlers","handlers","ctx","__loop","letter","spawn","fn","createMailbox","subs","Set","kvs","sendSelf","broadcast","subscribe","sub","add","unsubscribe","delete","subscriberCount","size","hasSubs","put","key","value","get","fallback","update","keys","Object","all","where","pattern","reduce","acc","test","merge","forEach","fatalError","subscriber","address","spawnFn","callback","snapshoter"],"mappings":"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"}